<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ConvertIQ ‚Äî Merge PDFs</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <style>
    /* These are ONLY tiny helpers, you can keep them */
    .file-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:6px 8px;
      border-radius:6px;
      background:#fbfbfb;
      margin-bottom:8px;
      border:1px solid #eee;
    }
    .file-name {
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width:70%;
    }
    .remove-btn {
      background:transparent;
      border:0;
      color:#c33;
      cursor:pointer;
      font-weight:600;
    }
    #dropPreview { margin-top:12px; text-align:left; }
  </style>
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <div class="header">
    <a href="{{ url_for('index') }}" style="text-decoration:none; color:inherit;">
      <h1 style="cursor:pointer;">ConvertIQ</h1>
    </a>

    <div class="tabs" role="tablist">
      <a href="{{ url_for('pdfsplit_page') }}" class="tab">PDF Splitter</a>
      <a href="{{ url_for('pdf_to_images_page') }}" class="tab">PDF ‚Üí Images</a>
      <a href="{{ url_for('image_to_pdf_page') }}" class="tab">Images ‚Üí PDF</a>
      <a href="{{ url_for('pdf_to_docx_page') }}" class="tab">PDF ‚Üí Word</a>
      <a href="{{ url_for('pdf_to_text_page') }}" class="tab">PDF ‚Üí Text</a>
      <a href="{{ url_for('pdf_merge_page') }}" class="tab active">Merge PDFs</a>
    </div>
  </div>

  <!-- PAGE CONTENT -->
  <div class="content">
    <div class="upload-section">

      <h2>Merge PDF Files</h2>
      <p style="color:#555;margin-top:6px;">
        Select two or more PDF files. They will be merged in the order you select them (top ‚Üí bottom).
      </p>

      <!-- FORM -->
      <form method="post" action="{{ url_for('merge_pdfs') }}"
            enctype="multipart/form-data" class="upload-form" id="mergeForm">

        <!-- hidden input -->
        <input type="file" name="pdf_files[]" id="pdfFiles" multiple accept="application/pdf" style="display:none;">

        <!-- styled drop zone using your CSS -->
        <div class="file-input-wrapper">
          <label id="dropZone" for="pdfFiles" class="file-input-label" role="button">

            <span class="file-icon">üìÑ</span>
            <span class="file-text">Choose PDF File</span>
            <div style="font-size:13px;color:#666;margin-top:6px;">
              or drag & drop files here
            </div>

            <!-- preview INSIDE the upload box -->
            <div id="dropPreview"></div>
          </label>
        </div>
        <br>
        <button type="submit" class="submit-btn">Merge PDFs</button>
      </form>

      <p style="text-align:center;margin-top:12px;color:#666;">
        <a href="{{ url_for('index') }}">‚Üê Back to Home</a>
      </p>
    </div>
  </div>

</div>

<!-- SCRIPT -->
<script>
(function() {

  const input = document.getElementById("pdfFiles");
  const dropZone = document.getElementById("dropZone");
  const dropPreview = document.getElementById("dropPreview");

  const storedFiles = [];

  function fileKey(f) {
    return `${f.name}_${f.size}_${f.lastModified}`;
  }

  function syncInputFiles() {
    const dt = new DataTransfer();
    storedFiles.forEach(f => dt.items.add(f));
    input.files = dt.files;
  }

  function renderUI() {
    if (!storedFiles.length) {
      dropPreview.innerHTML = `<div style="color:#999;font-size:14px;">No files chosen</div>`;
      return;
    }

    dropPreview.innerHTML = storedFiles.map((f, i) => `
      <div class="file-item">
        <div class="file-name">${i+1}. ${f.name}</div>
        <div style="display:flex;align-items:center;gap:10px;">
          <div style="font-size:12px;color:#666;">
            ${(f.size/1024/1024).toFixed(2)} MB
          </div>
          <button type="button" class="remove-btn" data-index="${i}">Remove</button>
        </div>
      </div>
    `).join("");

    // remove handlers
    dropPreview.querySelectorAll(".remove-btn").forEach(btn => {
      btn.onclick = e => {
        storedFiles.splice(parseInt(e.target.dataset.index), 1);
        renderUI();
      };
    });

    syncInputFiles();
  }

  function addFiles(files) {
    const existing = new Set(storedFiles.map(fileKey));
    [...files].forEach(f => {
      const k = fileKey(f);
      if (!existing.has(k)) storedFiles.push(f);
    });
    renderUI();
  }

  /* --- EVENTS --- */

  input.addEventListener("change", e => addFiles(e.target.files));

  dropZone.addEventListener("dragover", e => {
    e.preventDefault();
    dropZone.style.borderColor = "#3498db";
  });

  dropZone.addEventListener("dragleave", () => {
    dropZone.style.borderColor = "#dee2e6";
  });

  dropZone.addEventListener("drop", e => {
    e.preventDefault();
    dropZone.style.borderColor = "#dee2e6";
    addFiles(e.dataTransfer.files);
  });

  document.getElementById("mergeForm").addEventListener("submit", e => {
    if (storedFiles.length < 2) {
      e.preventDefault();
      alert("Please select at least two PDF files.");
    }
    if (storedFiles.length > 50) {
      e.preventDefault();
      alert("Maximum 50 files allowed.");
    }
    syncInputFiles();
  });

  renderUI();

})();
</script>

</body>
</html>
